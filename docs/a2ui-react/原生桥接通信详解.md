# A2UI React H5 åŸç”Ÿæ¡¥æ¥é€šä¿¡è¯¦è§£

## ç›®å½•

1. [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
2. [æ¡¥æ¥é€šä¿¡åŸç†](#æ¡¥æ¥é€šä¿¡åŸç†)
3. [ä¸‰ç§å®ç°æ–¹å¼å¯¹æ¯”](#ä¸‰ç§å®ç°æ–¹å¼å¯¹æ¯”)
4. [OpenClaw çš„å®ç°](#openclaw-çš„å®ç°)
5. [å¼€å‘ä¸æµ‹è¯•](#å¼€å‘ä¸æµ‹è¯•)

---

## æ ¸å¿ƒæ¦‚å¿µ

### ä»€ä¹ˆæ˜¯åŸç”Ÿæ¡¥æ¥ï¼Ÿ

**åŸç”Ÿæ¡¥æ¥ï¼ˆNative Bridgeï¼‰** æ˜¯æŒ‡åœ¨åŸç”Ÿç§»åŠ¨åº”ç”¨ï¼ˆiOS/Androidï¼‰çš„ WebView ä¸­è¿è¡Œçš„ H5 é¡µé¢ï¼Œé€šè¿‡ç‰¹å®šçš„ JavaScript API ä¸åŸç”Ÿä»£ç è¿›è¡Œé€šä¿¡çš„æŠ€æœ¯ã€‚

**æœ¬è´¨**ï¼šH5 ä»£ç  â†’ JavaScript Bridge â†’ åŸç”Ÿä»£ç 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŸç”Ÿ App (Swift/Kotlin)                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  WebView (WKWebView / Android WebView)                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  H5 é¡µé¢ (HTML/JS/CSS)                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  JavaScript:                             â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  bridge.postMessage({ data: 'xxx' })    â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                      â”‚                                 â”‚  â”‚
â”‚  â”‚                      â–¼ JavaScript Bridge               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Native Code:                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  å¤„ç†æ¶ˆæ¯ã€è°ƒç”¨ç³»ç»Ÿ APIã€è¿”å›ç»“æœ               â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¡¥æ¥é€šä¿¡çš„ç‰¹ç‚¹

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **åŒå‘é€šä¿¡** | H5 å¯ä»¥è°ƒç”¨åŸç”Ÿï¼ŒåŸç”Ÿå¯ä»¥å›è°ƒ H5 |
| **å¼‚æ­¥æœºåˆ¶** | é€šè¿‡å›è°ƒæˆ– Promise å¤„ç†å¼‚æ­¥ç»“æœ |
| **æ²™ç®±éš”ç¦»** | H5 åœ¨ WebView æ²™ç®±ä¸­è¿è¡Œï¼Œå—å®‰å…¨é™åˆ¶ |
| **å¹³å°å·®å¼‚** | iOS å’Œ Android æœ‰ä¸åŒçš„æ¡¥æ¥ API |

---

## æ¡¥æ¥é€šä¿¡åŸç†

### iOS æ¡¥æ¥æœºåˆ¶

**API**: `window.webkit.messageHandlers.<handlerName>.postMessage(message)`

```swift
// iOS åŸç”Ÿç«¯ (Swift)
import WebKit

// 1. åˆ›å»ºæ¶ˆæ¯å¤„ç†å™¨
class ActionHandler: NSObject, WKScriptMessageHandler {
    func userContentController(
        _ userContentController: WKUserContentController,
        didReceive message: WKScriptMessage
    ) {
        // æ”¶åˆ° H5 å‘é€çš„æ¶ˆæ¯
        if let body = message.body as? [String: Any] {
            print("æ”¶åˆ° H5 æ¶ˆæ¯: \(body)")
            // å¤„ç†æ¶ˆæ¯...
        }
    }
}

// 2. æ³¨å†Œå¤„ç†å™¨
let config = WKWebViewConfiguration()
let userContentController = WKUserContentController()
let handler = ActionHandler()
userContentController.add(handler, name: "openclawAction")
config.userContentController = userContentController

// 3. åˆ›å»º WebView
let webView = WKWebView(frame: .zero, configuration: config)
```

```javascript
// H5 ç«¯ (JavaScript)
// è°ƒç”¨åŸç”Ÿä»£ç 
if (window.webkit?.messageHandlers?.openclawAction) {
    window.webkit.messageHandlers.openclawAction.postMessage({
        action: 'clickButton',
        data: { buttonId: 'submit' }
    });
}
```

### Android æ¡¥æ¥æœºåˆ¶

**API**: `window.<interfaceName>.<method>(string)`

**æ³¨æ„**: Android çš„ JavaScript Interface åªæ”¯æŒä¼ é€’å­—ç¬¦ä¸²ï¼Œéœ€è¦ JSON åºåˆ—åŒ–ã€‚

```kotlin
// Android åŸç”Ÿç«¯ (Kotlin)
import android.webkit.WebView
import android.webkit.JavascriptInterface

// 1. å®šä¹‰æ¥å£ç±»
class ActionInterface {
    @JavascriptInterface
    fun postMessage(message: String): String {
        // æ”¶åˆ° H5 å‘é€çš„æ¶ˆæ¯ï¼ˆJSON å­—ç¬¦ä¸²ï¼‰
        val json = JSONObject(message)
        println("æ”¶åˆ° H5 æ¶ˆæ¯: $json")
        // å¤„ç†æ¶ˆæ¯...
        return "{\"ok\": true}"
    }
}

// 2. æ³¨å†Œæ¥å£
val webView = WebView(context)
webView.settings.javaScriptEnabled = true
webView.addJavascriptInterface(ActionInterface(), "openclawAction")
```

```javascript
// H5 ç«¯ (JavaScript)
// è°ƒç”¨åŸç”Ÿä»£ç ï¼ˆéœ€è¦ JSON.stringifyï¼‰
if (window.openclawAction) {
    const message = JSON.stringify({
        action: 'clickButton',
        data: { buttonId: 'submit' }
    });
    window.openclawAction.postMessage(message);
}
```

### çº¯ H5 æ¨¡å¼

**API**: `fetch('/api/xxx', ...)`

```javascript
// H5 ç«¯ (JavaScript)
// çº¯æµè§ˆå™¨æ¨¡å¼ï¼Œé€šè¿‡ HTTP è¯·æ±‚ä¸åç«¯é€šä¿¡
fetch('/api/a2ui/action', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        action: 'clickButton',
        data: { buttonId: 'submit' }
    })
}).then(res => res.json());
```

---

## ä¸‰ç§å®ç°æ–¹å¼å¯¹æ¯”

### 1. æ‰‹åŠ¨å®ç°æ¡¥æ¥ï¼ˆOpenClaw å½“å‰æ–¹æ¡ˆï¼‰

**ç‰¹ç‚¹**ï¼šç›´æ¥ä½¿ç”¨å¹³å°åŸç”Ÿ APIï¼Œæ— éœ€é¢å¤–æ¡†æ¶

```javascript
// H5 ç«¯
const handler = window.webkit?.messageHandlers?.openclawAction ??
                window.openclawAction;

if (handler?.postMessage) {
    const payload = isAndroid ? JSON.stringify(data) : data;
    handler.postMessage(payload);
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… æ— é¢å¤–ä¾èµ–
- âœ… æ€§èƒ½æœ€ä¼˜ï¼ˆç›´æ¥è°ƒç”¨åŸç”Ÿ APIï¼‰
- âœ… çµæ´»åº¦é«˜ï¼Œå®Œå…¨å¯æ§
- âœ… åŒ…ä½“ç§¯å°

**ç¼ºç‚¹**ï¼š
- âŒ éœ€è¦æ‰‹åŠ¨å¤„ç†å¹³å°å·®å¼‚
- âŒ éœ€è¦è‡ªå·±å®ç°é”™è¯¯å¤„ç†
- âŒ éœ€è¦è‡ªå·±ç®¡ç†å›è°ƒ

**é€‚ç”¨åœºæ™¯**ï¼š
- å·²æœ‰åŸç”Ÿ Appï¼Œéœ€è¦é›†æˆ H5 é¡µé¢
- å¯¹æ€§èƒ½å’ŒåŒ…ä½“ç§¯æ•æ„Ÿ
- å›¢é˜Ÿç†Ÿæ‚‰åŸç”Ÿå¼€å‘

### 2. Ionic/Cordova æ¡†æ¶æ–¹æ¡ˆ

**ç‰¹ç‚¹**ï¼šé€šè¿‡æ¡†æ¶å°è£…çš„æ’ä»¶ç³»ç»Ÿä¸åŸç”Ÿé€šä¿¡

```javascript
// H5 ç«¯ (Ionic/Cordova)
cordova.exec(
    successCallback,
    errorCallback,
    "PluginName",
    "actionName",
    [data]
);
```

**ä¼˜ç‚¹**ï¼š
- âœ… ç»Ÿä¸€çš„ APIï¼Œè·¨å¹³å°ä¸€è‡´
- âœ… ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€
- âœ… æ¡†æ¶å¤„ç†å¹³å°å·®å¼‚
- âœ… æˆç†Ÿçš„å·¥å…·é“¾

**ç¼ºç‚¹**ï¼š
- âŒ ä¾èµ–æ¡†æ¶å’Œæ’ä»¶
- âŒ åŒ…ä½“ç§¯è¾ƒå¤§ï¼ˆåŒ…å« cordova.jsï¼‰
- âŒ æ€§èƒ½ç•¥ä½äºåŸç”Ÿ API
- âŒ æ’ä»¶æ›´æ–°æ»å

**é€‚ç”¨åœºæ™¯**ï¼š
- å¿«é€Ÿå¼€å‘æ··åˆ App
- ä¾èµ–å¤§é‡åŸç”ŸåŠŸèƒ½ï¼ˆç›¸æœºã€GPS ç­‰ï¼‰
- å›¢é˜Ÿä»¥ Web æŠ€æœ¯ä¸ºä¸»

### 3. React Native æ–¹æ¡ˆ

**ç‰¹ç‚¹**ï¼šJavaScript â†’ Native Module è½¬æ¢

```javascript
// React Native
import { NativeModules } from 'react-native';

NativeModules.ActionModule.actionName(data, (result) => {
    console.log(result);
});
```

**ä¼˜ç‚¹**ï¼š
- âœ… åŸç”Ÿæ€§èƒ½
- âœ… JavaScript å’ŒåŸç”Ÿç»„ä»¶æ··åˆ
- âœ… æˆç†Ÿçš„ç”Ÿæ€

**ç¼ºç‚¹**ï¼š
- âŒ ä¸æ˜¯çº¯ H5ï¼Œéœ€è¦ RN è¿è¡Œæ—¶
- âŒ å­¦ä¹ æ›²çº¿é™¡å³­
- âŒ åŒ…ä½“ç§¯è¾ƒå¤§

**é€‚ç”¨åœºæ™¯**ï¼š
- éœ€è¦æ¥è¿‘åŸç”Ÿçš„æ€§èƒ½
- éœ€è¦å¤æ‚çš„åŸç”Ÿäº¤äº’
- é•¿æœŸç»´æŠ¤çš„å¤§å‹åº”ç”¨

---

## OpenClaw çš„å®ç°

### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OpenClaw åŸç”Ÿ App                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  WKWebView (iOS) / WebView (Android)                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  A2UI React H5 é¡µé¢                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  React ç»„ä»¶ (Button, Text, Card...)        â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚         â”‚                                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚         â–¼ ç”¨æˆ·ç‚¹å‡»                                â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  bridgeAdapter.postMessage(userAction)     â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚    â†’ iOS: webkit.messageHandlers           â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚    â†’ Android: window.openclawAction        â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚    â†’ H5: fetch('/api/a2ui/action')         â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                       â”‚                                  â”‚  â”‚
â”‚  â”‚                       â–¼                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  iOS: CanvasA2UIActionMessageHandler             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Android: OpenClawActionInterface                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â†’ å¤„ç†åŠ¨ä½œ                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â†’ å‘é€æ¶ˆæ¯                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â†’ è°ƒç”¨ç³»ç»Ÿ API                               â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è‡ªåŠ¨æ£€æµ‹å¹³å°

```typescript
// bridgeAdapter.ts
private detectPlatform(): PlatformInfo {
    const ua = navigator.userAgent;
    return {
        isAndroid: /Android/i.test(ua),
        isIOS: /iPhone|iPad|iPod/i.test(ua),
        isPureH5: !/Android|iPhone|iPad|iPod/i.test(ua),
        userAgent: ua
    };
}
```

### ç»Ÿä¸€çš„è°ƒç”¨æ¥å£

```typescript
// H5 ç«¯ç»Ÿä¸€æ¥å£
async postMessage(userAction: UserAction): Promise<BridgeResult> {
    if (this.platform.isPureH5) {
        // çº¯ H5ï¼šå‘é€åˆ°åç«¯ API
        return await this.postToBackend(userAction);
    }
    // iOS/Androidï¼šå‘é€åˆ°åŸç”Ÿ
    return await this.postToNative(userAction);
}

private async postToNative(userAction: UserAction) {
    const bridge = this.getNativeBridge();
    if (!bridge?.postMessage) {
        return { ok: false, error: 'åŸç”Ÿæ¡¥æ¥æœªæ‰¾åˆ°' };
    }

    const payload = this.platform.isIOS
        ? { userAction }              // iOS: ç›´æ¥ä¼ å¯¹è±¡
        : JSON.stringify({ userAction }); // Android: ä¼  JSON å­—ç¬¦ä¸²

    bridge.postMessage(payload);
    return { ok: true };
}
```

### iOS åŸç”Ÿç«¯å®ç°

```swift
// apps/ios/Sources/Screen/ScreenController.swift

private final class CanvasA2UIActionMessageHandler: NSObject, WKScriptMessageHandler {
    static let messageName = "openclawCanvasA2UIAction"

    weak var controller: ScreenController?

    func userContentController(
        _: WKUserContentController,
        didReceive message: WKScriptMessage
    ) {
        // éªŒè¯æ¥æº
        guard let url = message.webView?.url else { return }
        if url.isFileURL {
            guard controller?.isTrustedCanvasUIURL(url) ?? false else { return }
        } else {
            guard controller?.isLocalNetworkCanvasURL(url) ?? false else { return }
        }

        // è§£ææ¶ˆæ¯
        guard let body = ScreenController.parseA2UIActionBody(message.body) else { return }

        // è§¦å‘å›è°ƒï¼ˆåŸç”Ÿä»£ç å¤„ç†ï¼‰
        controller?.onA2UIAction?(body)
    }
}
```

---

## å¼€å‘ä¸æµ‹è¯•

### çº¯ H5 å¼€å‘ï¼ˆæµè§ˆå™¨ï¼‰

**æ— éœ€åŸç”Ÿ App**ï¼Œå¯ä»¥å¼€å‘ 90% çš„åŠŸèƒ½ï¼š

```bash
# 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run a2ui:react:dev

# 2. æµè§ˆå™¨è®¿é—®
# http://localhost:18789

# 3. æ¨¡æ‹Ÿç§»åŠ¨è®¾å¤‡
# F12 â†’ åˆ‡æ¢è®¾å¤‡å·¥å…·æ  â†’ é€‰æ‹© iPhone

# 4. Mock æ¡¥æ¥å¯¹è±¡ï¼ˆå¯é€‰ï¼‰
window.webkit = {
    messageHandlers: {
        openclawCanvasA2UIAction: {
            postMessage: (data) => console.log('æ¨¡æ‹Ÿæ¡¥æ¥:', data)
        }
    }
};
```

**å¯æµ‹è¯•å†…å®¹**ï¼š
- âœ… æ‰€æœ‰ç»„ä»¶æ¸²æŸ“
- âœ… UI äº¤äº’æ•ˆæœ
- âœ… ä¸»é¢˜åˆ‡æ¢
- âœ… æ•°æ®æ¨¡å‹
- âœ… å“åº”å¼å¸ƒå±€
- âŒ åŸç”Ÿæ¡¥æ¥é€šä¿¡ï¼ˆéœ€è¦åŸç”Ÿ Appï¼‰

### åŸç”Ÿæ¡¥æ¥æµ‹è¯•

**éœ€è¦åŸç”Ÿ App ç¯å¢ƒ**ï¼š

```bash
# 1. æ„å»º H5 ç”Ÿäº§ç‰ˆæœ¬
npm run a2ui:react:build

# 2. æ„å»º iOS App
cd apps/ios
xcodebuild -scheme OpenClaw -sdk iphonesimulator

# 3. è¿è¡Œæ¨¡æ‹Ÿå™¨
# Xcode â†’ è¿è¡ŒæŒ‰é’®

# 4. App è‡ªåŠ¨åŠ è½½ H5
# åœ¨ App ä¸­æµ‹è¯•æŒ‰é’®ç‚¹å‡»

# 5. æŸ¥çœ‹ Swift æ—¥å¿—
# Xcode â†’ æ§åˆ¶å°è¾“å‡º
```

### è°ƒè¯•æŠ€å·§

#### H5 ç«¯è°ƒè¯•

```javascript
// åœ¨æµè§ˆå™¨æˆ– WebView æ§åˆ¶å°æ‰§è¡Œ

// 1. æ£€æŸ¥å¹³å°
console.log('isIOS:', /iPhone|iPad|iPod/i.test(navigator.userAgent));
console.log('isAndroid:', /Android/i.test(navigator.userAgent));
console.log('isPureH5:', !/Android|iPhone|iPad|iPod/i.test(navigator.userAgent));

// 2. æ£€æŸ¥æ¡¥æ¥å¯¹è±¡
console.log('iOS æ¡¥æ¥:', window.webkit?.messageHandlers?.openclawCanvasA2UIAction);
console.log('Android æ¡¥æ¥:', window.openclawCanvasA2UIAction);

// 3. æ£€æŸ¥å…¨å±€ API
console.log('A2UI API:', window.openclawA2UI);

// 4. æµ‹è¯•å‘é€åŠ¨ä½œ
window.openclawA2UI.applyMessages([/* æ¶ˆæ¯ */]);
```

#### åŸç”Ÿç«¯è°ƒè¯•ï¼ˆiOSï¼‰

```swift
// ScreenController.swift

func userContentController(
    _: WKUserContentController,
    didReceive message: WKScriptMessage
) {
    print("ğŸ“¨ æ”¶åˆ° H5 æ¶ˆæ¯: \(message.body)")
    guard let body = ScreenController.parseA2UIActionBody(message.body) else {
        print("âŒ æ¶ˆæ¯è§£æå¤±è´¥")
        return
    }
    print("âœ… è§£ææˆåŠŸ: \(body)")

    // è§¦å‘å›è°ƒ
    controller?.onA2UIAction?(body)
}
```

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ Ionic/Cordovaï¼Ÿ

**A**:
- OpenClaw å·²æœ‰å®Œæ•´çš„åŸç”Ÿ App
- åªéœ€è¦ H5 ä½œä¸º UI å±‚ï¼Œä¸éœ€è¦å®Œæ•´çš„æ··åˆ App æ¡†æ¶
- æ‰‹åŠ¨å®ç°æ¡¥æ¥æ›´è½»é‡ã€æ€§èƒ½æ›´å¥½
- é¿å…æ¡†æ¶ç‰ˆæœ¬å‡çº§å¸¦æ¥çš„å…¼å®¹æ€§é—®é¢˜

### Q2: çº¯ H5 æ¨¡å¼ä¸‹ç‚¹å‡»æŒ‰é’®æ²¡ååº”ï¼Ÿ

**A**: è¿™æ˜¯æ­£å¸¸çš„ï¼

```javascript
// çº¯ H5 æ¨¡å¼ä¼šå°è¯• POST /api/a2ui/action
// ä½†è¯¥æ¥å£å¯èƒ½ä¸å­˜åœ¨ï¼ˆ404ï¼‰

// è§£å†³æ–¹æ¡ˆ 1: åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­ mock
window.openclawCanvasA2UIAction = {
    postMessage: (data) => console.log('Mock:', data)
};

// è§£å†³æ–¹æ¡ˆ 2: åœ¨åŸç”Ÿ App ä¸­æµ‹è¯•
```

### Q3: å¦‚ä½•åœ¨çœŸæœºä¸Šæµ‹è¯•ï¼Ÿ

**A**:

```bash
# iOS çœŸæœº
1. è¿æ¥ iPhone åˆ° Mac
2. Xcode é€‰æ‹©çœŸæœºè®¾å¤‡
3. ç‚¹å‡»è¿è¡Œ
4. ä¿¡ä»»å¼€å‘è€…è¯ä¹¦ï¼ˆè®¾ç½® â†’ é€šç”¨ â†’ VPN ä¸è®¾å¤‡ç®¡ç†ï¼‰

# Android çœŸæœº
1. å¼€å¯å¼€å‘è€…é€‰é¡¹
2. å…è®¸ USB è°ƒè¯•
3. è¿æ¥åˆ°ç”µè„‘
4. è¿è¡Œ ./gradlew installDebug
```

### Q4: ä¸‰ç§æ¨¡å¼å¯ä»¥æ··ç”¨å—ï¼Ÿ

**A**: å¯ä»¥ï¼H5 ä»£ç ä¼šè‡ªåŠ¨æ£€æµ‹ç¯å¢ƒï¼š

```javascript
// åŒä¸€ä»½ H5 ä»£ç å¯ä»¥åœ¨ä¸‰ç§ç¯å¢ƒè¿è¡Œï¼š

// ç¯å¢ƒ 1: æµè§ˆå™¨
// â†’ è‡ªåŠ¨é™çº§åˆ° H5 æ¨¡å¼
// â†’ åŠ¨ä½œå‘é€åˆ° /api/a2ui/action

// ç¯å¢ƒ 2: iOS App
// â†’ è‡ªåŠ¨ä½¿ç”¨ iOS æ¡¥æ¥
// â†’ åŠ¨ä½œå‘é€åˆ° Swift ä»£ç 

// ç¯å¢ƒ 3: Android App
// â†’ è‡ªåŠ¨ä½¿ç”¨ Android æ¡¥æ¥
// â†’ åŠ¨ä½œå‘é€åˆ° Kotlin ä»£ç 
```

---

## æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **æ¡¥æ¥é€šä¿¡çš„æœ¬è´¨**ï¼šWebView çš„ JavaScript Bridgeï¼ŒH5 è°ƒç”¨åŸç”Ÿä»£ç 
2. **ä¸‰ç§æ–¹æ¡ˆæœ¬è´¨ç›¸åŒ**ï¼šæ‰‹åŠ¨å®ç°ã€Ionic/Cordovaã€React Native éƒ½åŸºäºåŒä¸€åŸç†
3. **OpenClaw çš„é€‰æ‹©**ï¼šæ‰‹åŠ¨å®ç°ï¼Œè½»é‡é«˜æ•ˆï¼Œé€‚åˆå·²æœ‰åŸç”Ÿ App çš„åœºæ™¯
4. **çµæ´»é€‚é…**ï¼šè‡ªåŠ¨æ£€æµ‹å¹³å°ï¼Œæ”¯æŒ iOSã€Androidã€çº¯ H5 ä¸‰ç§æ¨¡å¼

### æœ€ä½³å®è·µ

- **å¼€å‘é˜¶æ®µ**ï¼šä½¿ç”¨çº¯ H5 æ¨¡å¼ï¼ˆæµè§ˆå™¨ï¼‰ï¼Œå¿«é€Ÿè¿­ä»£
- **é›†æˆæµ‹è¯•**ï¼šä½¿ç”¨åŸç”Ÿ App æ¨¡å¼ï¼ŒéªŒè¯æ¡¥æ¥é€šä¿¡
- **ç”Ÿäº§éƒ¨ç½²**ï¼šä¸€ä»½ H5 ä»£ç ï¼Œä¸‰ç§ç¯å¢ƒé€šç”¨

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-02-04
**ä½œè€…**: OpenClaw Team
