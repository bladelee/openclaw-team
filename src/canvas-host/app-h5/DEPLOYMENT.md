# OpenClaw H5 App Phase 1 部署指南

## 快速开始

### 方法 1: 使用 Python HTTP 服务器（推荐）

```bash
# 1. 进入部署目录
cd /tmp/openclaw-h5-deploy

# 2. 启动服务器
python3 -m http.server 8080

# 3. 访问应用
# 本地: http://localhost:8080
# 网络: http://<IP>:8080
```

### 方法 2: 使用 npx serve

```bash
# 安装并启动 serve
npx serve dist/app-h5 -l 8080
```

### 方法 3: 使用 Vite 开发服务器（功能最全）

```bash
# 启动开发服务器（支持热更新）
pnpm app:h5:dev

# 访问 http://localhost:18790
```

---

## 功能测试

### 基础 UI 测试（无需 Gateway）

#### 聊天页面

**测试步骤**:
1. 打开应用，默认进入聊天页面
2. 检查页面元素:
   - ✅ 标题显示 "💬 OpenClaw 聊天"
   - ✅ 连接状态显示 "○ 未连接"
   - ✅ 空状态提示显示 "👋 开始对话吧！"
   - ✅ 输入框可以输入文字
   - ✅ 发送按钮默认禁用（输入文字后启用）

**预期结果**:
- 界面显示正常
- 输入框响应键盘输入
- 按钮状态根据输入变化

#### 设置页面

**测试步骤**:
1. 点击聊天页面右上角的 "⚙️ 设置" 按钮
2. 检查页面元素:
   - ✅ 标题显示 "⚙️ 设置"
   - ✅ 返回按钮可用
   - ✅ Gateway 连接状态显示
   - ✅ Gateway 地址输入框（格式: ws://IP:PORT）
   - ✅ 主题切换按钮（自动/浅色/深色）
   - ✅ 版本信息显示

**主题切换测试**:
1. 点击 "● 自动" → 系统主题
2. 点击 "◑ 浅色" → 浅色主题
3. 点击 "◐ 深色" → 深色主题
4. 刷新页面，主题保持

**预期结果**:
- 主题切换立即生效
- 本地存储保存主题设置
- 页面刷新后主题保持

#### 返回功能

**测试步骤**:
1. 在设置页面点击 "← 返回"
2. 应该返回聊天页面

**预期结果**:
- 页面切换流畅
- 状态保持正确

---

### WebSocket 功能测试（需要 Gateway）

#### 启动 Gateway

```bash
# 方法 1: 开发模式
pnpm gateway:dev

# 方法 2: 生产模式
bun run openclaw gateway run

# 方法 3: 指定端口
bun run openclaw gateway run --port 18789
```

#### 连接测试

**测试步骤**:
1. 确保 Gateway 运行在 `ws://localhost:18789`
2. 打开 H5 应用
3. 检查连接状态从 "○ 未连接" 变为 "● 已连接"

**预期结果**:
- 连接状态自动更新
- 显示 "● 已连接到 localhost"

#### 发送消息测试

**测试步骤**:
1. 在输入框输入 "你好"
2. 点击 "发送" 按钮
3. 观察消息出现在列表中
4. 检查消息:
   - ✅ 显示 "You" 标签
   - ✅ 显示时间戳
   - ✅ 背景色为蓝色
   - ✅ 状态从 "发送中..." 变为正常

**预期结果**:
- 消息立即显示在列表
- 用户消息在右侧
- 发送状态指示正确

#### 接收消息测试

**测试步骤**:
1. Gateway 发送回复消息
2. 检查 AI 消息:
   - ✅ 显示 "AI" 标签
   - ✅ 显示时间戳
   - ✅ 背景色为灰色
   - ✅ 在左侧显示

**预期结果**:
- AI 消息正确显示
- 消息顺序正确（用户→AI）

#### 断开连接测试

**测试步骤**:
1. 进入设置页面
2. 点击 "断开连接" 按钮
3. 返回聊天页面
4. 检查连接状态变为 "○ 未连接"

**预期结果**:
- 连接正确断开
- 状态更新正确

#### 重连测试

**测试步骤**:
1. 在设置页面点击 "连接" 按钮
2. 检查连接状态恢复

**预期结果**:
- 重新连接成功
- 状态更新正确

---

## 响应式测试

### 桌面浏览器

**测试环境**:
- Chrome 120+
- Firefox 120+
- Safari 17+
- Edge 120+

**测试尺寸**:
- 1920x1080 (桌面)
- 1366x768 (笔记本)
- 1024x768 (小平板)

### 移动设备

**测试环境**:
- iOS Safari 17+
- Android Chrome 120+

**测试尺寸**:
- 390x844 (iPhone 14)
- 393x852 (iPhone 14 Pro Max)
- 414x896 (iPhone 11 Pro Max)

**测试要点**:
- ✅ 文字大小合适
- ✅ 按钮易于点击（最小 44x44px）
- ✅ 输入框不遮挡
- ✅ 消息列表滚动流畅

---

## 性能测试

### 加载性能

**测试工具**: Chrome DevTools Lighthouse

**目标**:
- 首次内容绘制 (FCP) < 1s
- 最大内容绘制 (LCP) < 2.5s
- 累积布局偏移 (CLS) < 0.1

**测试步骤**:
1. 打开 Chrome DevTools
2. 切换到 Lighthouse 面板
3. 选择 "Progressive Web App"
4. 点击 "Analyze page load"

### 运行时性能

**测试要点**:
- ✅ 输入响应流畅（无卡顿）
- ✅ 消息列表滚动流畅（60fps）
- ✅ 主题切换快速（<100ms）

---

## 兼容性测试

### 浏览器兼容性

| 浏览器 | 版本 | 状态 |
|--------|------|------|
| Chrome | 120+ | ✅ |
| Firefox | 120+ | ✅ |
| Safari | 17+ | ✅ |
| Edge | 120+ | ✅ |

### Web API 支持

| API | 支持 | 备注 |
|-----|------|------|
| WebSocket | ✅ | 所有现代浏览器 |
| localStorage | ✅ | 所有现代浏览器 |
| matchMedia | ✅ | 主题切换 |
| CSS Variables | ✅ | 主题系统 |

---

## 已知问题

### 限制

1. **H5 平台限制**
   - 标签页关闭后连接断开
   - 无法后台运行
   - 推送通知受限

2. **Phase 1 范围**
   - 不支持多媒体附件
   - 不支持语音功能
   - 不支持 Canvas 页面

### 问题反馈

如发现问题，请记录以下信息:
- 浏览器类型和版本
- 设备类型（桌面/移动）
- 操作系统
- 重现步骤
- 预期行为 vs 实际行为

---

## 部署检查清单

### 部署前

- [x] 代码构建成功
- [x] Lint 检查通过
- [x] 单元测试通过
- [x] 文档完整

### 部署后

- [ ] 页面可访问
- [ ] 静态资源加载正常
- [ ] 控制台无错误
- [ ] 功能测试通过

---

## 下一步

### Phase 2 准备

**多媒体功能** (1-2 周):
- [ ] 相机拍照
- [ ] 位置服务
- [ ] 文件上传
- [ ] 图片附件

### 优化建议

根据测试结果可能需要:
- 性能优化
- UX 改进
- Bug 修复
- 功能增强

---

**部署日期**: 2025-02-04
**版本**: Phase 1 MVP
**状态**: ✅ 可用于测试
