# OpenClaw H5 App Phase 1 测试说明

## 📋 测试概述

本文档提供 Phase 1 的完整测试指南，包括部署、功能测试和问题反馈。

---

## 🚀 快速部署

### 选项 1: 使用已准备好的部署文件

```bash
# 部署文件已复制到 /tmp/openclaw-h5-deploy/
cd /tmp/openclaw-h5-deploy

# 启动 HTTP 服务器
python3 -m http.server 8080

# 访问: http://localhost:8080
```

### 选项 2: 使用项目构建文件

```bash
# 1. 构建（如果还没构建）
pnpm app:h5:build

# 2. 启动开发服务器（推荐）
pnpm app:h5:dev

# 访问: http://localhost:18790
```

### 选项 3: 使用 serve 包

```bash
# 全局安装 serve
npm install -g serve

# 启动服务器
serve dist/app-h5 -l 8080

# 访问: http://localhost:8080
```

---

## ✅ 测试清单

### 基础功能（无需 Gateway）

#### 1. 页面加载

- [ ] 页面在浏览器中正常显示
- [ ] 无控制台错误
- [ ] 静态资源加载正常（CSS、JS）
- [ ] 页面标题显示 "OpenClaw H5"

#### 2. 聊天页面

**UI 元素检查**:
- [ ] 页面标题: "💬 OpenClaw 聊天"
- [ ] 连接状态显示: "○ 未连接"（红色）
- [ ] 空状态提示: "👋 开始对话吧！"
- [ ] 输入框占位符: "输入消息... (Enter 发送, Shift+Enter 换行)"
- [ ] 发送按钮: 初始状态为禁用

**交互测试**:
- [ ] 点击输入框，可以输入文字
- [ ] 输入文字后，发送按钮变为启用状态
- [ ] 清空输入框后，发送按钮恢复禁用状态
- [ ] 按 Enter 键发送消息（需要先输入文字）
- [ ] 按 Shift+Enter 换行（不发送）

#### 3. 设置页面

**导航**:
- [ ] 点击右上角设置按钮进入设置页面
- [ ] 点击返回按钮回到聊天页面

**UI 元素检查**:
- [ ] 页面标题: "⚙️ 设置"
- [ ] Gateway 连接状态卡片
- [ ] 连接配置卡片（包含 Gateway 地址输入框）
- [ ] 外观主题卡片（包含 3 个主题选项）
- [ ] 关于卡片（包含版本信息）

**Gateway 连接测试**:
- [ ] 连接状态显示 "○ 未连接"
- [ ] Gateway 地址输入框可编辑
- [ ] 连接按钮可点击
- [ ] 断开连接按钮显示（仅连接时）

**主题切换测试**:
- [ ] 点击 "● 自动": 跟随系统主题
- [ ] 点击 "◑ 浅色": 切换到浅色主题
- [ ] 点击 "◐ 深色": 切换到深色主题
- [ ] 刷新页面，主题设置保持
- [ ] 检查 CSS 变量正确应用

**深色主题验证**:
- [ ] 背景变深色 (#111827)
- [ ] 文字变浅色 (#f9fafb)
- [ ] 输入框背景变深色
- [ ] 按钮保持蓝色（稍微变亮 #60a5fa）

**浅色主题验证**:
- [ ] 背景变白色 (#ffffff)
- [ ] 文字变深色 (#111827)
- [ ] 输入框背景变白色
- [ ] 按钮为蓝色 (#3b82f6)

#### 4. 响应式设计

**桌面浏览器** (宽度 > 640px):
- [ ] 页面居中显示
- [ ] 最大宽度 800px
- [ ] 消息项最大宽度 80%
- [ ] 布局美观舒适

**移动设备** (宽度 ≤ 640px):
- [ ] 页面占满屏幕宽度
- [ ] 消息项最大宽度 90%
- [ ] 按钮大小适中（易于点击）
- [ ] 字体大小合适
- [ ] 间距舒适

**不同屏幕尺寸测试**:
- [ ] 1920x1080 (桌面)
- [ ] 1366x768 (笔记本)
- [ ] 390x844 (iPhone 14)
- [ ] 393x852 (iPhone 14 Pro)

---

## 🌐 WebSocket 功能测试（需要 Gateway）

### 启动 Gateway

```bash
# 方法 1: 开发模式
pnpm gateway:dev

# 方法 2: 生产模式
bun run openclaw gateway run --port 18789

# 验证 Gateway 运行
# 应该看到类似输出:
# [Gateway] Listening on ws://localhost:18789
```

### 连接测试

1. **自动连接**
   - [ ] 页面加载时尝试连接
   - [ ] 连接成功后状态变为 "● 已连接"（绿色）
   - [ ] 显示服务器名称 "localhost"
   - [ ] 显示地址 "ws://localhost:18789"

2. **手动连接**
   - [ ] 在设置页面，点击 "连接" 按钮
   - [ ] 连接状态更新
   - [ ] 按钮文本变为 "连接中..." → "断开连接"

3. **断开连接**
   - [ ] 在设置页面，点击 "断开连接" 按钮
   - [ ] 连接状态变为 "○ 未连接"
   - [ ] 返回聊天页面，状态保持

4. **自动重连**
   - [ ] Gateway 重启后，H5 自动重连
   - [ ] 重连延迟指数增长（1s → 2s → 4s → ... → 30s）

### 消息收发测试

**发送消息**:
1. 在输入框输入 "测试消息"
2. 点击 "发送" 按钮
3. 检查:
   - [ ] 消息立即显示在列表
   - [ ] 用户消息在右侧
   - [ ] 背景色为蓝色
   - [ ] 显示 "You" 标签
   - [ ] 显示时间戳（格式: HH:MM）
   - [ ] 暂时显示 "发送中..." 状态
   - [ ] 状态很快消失（模拟发送完成）

**接收消息**:
1. 等待 Gateway 回复
2. 检查:
   - [ ] AI 消息在左侧
   - [ ] 背景色为浅灰色
   - [ ] 显示 "AI" 标签
   - [ ] 显示时间戳
   - [ ] 消息内容正确

**消息顺序**:
- [ ] 用户消息和 AI 消息交替显示
- [ ] 最新消息在底部
- [ ] 自动滚动到最新消息

### 多轮对话测试

1. 发送 "你好"
2. 等待回复
3. 发送 "今天天气怎么样？"
4. 等待回复
5. 发送 "谢谢"
6. 检查:
   - [ ] 所有消息正确显示
   - [ ] 消息顺序正确
   - [ ] 时间戳递增
   - [ ] 滚动流畅

---

## 🐛 问题报告

### 如何报告问题

请提供以下信息:

**基本信息**:
- 浏览器类型和版本
- 设备类型（桌面/移动/平板）
- 操作系统版本
- 网络环境（局域网/互联网）

**问题描述**:
- 重现步骤（详细）
- 预期行为
- 实际行为
- 截图或录屏（如果可能）

**控制台错误**:
1. 打开浏览器开发者工具（F12）
2. 切换到 Console 面板
3. 复制所有红色错误信息

**网络错误**:
1. 打开浏览器开发者工具（F12）
2. 切换到 Network 面板
3. 筛选 WS (WebSocket) 或 XHR (Fetch)
4. 截图失败请求

### 常见问题

**问题 1: 页面空白**
- 检查控制台错误
- 确认静态资源加载
- 尝试刷新页面

**问题 2: 无法连接 Gateway**
- 确认 Gateway 正在运行
- 检查端口号（默认 18789）
- 确认地址格式: `ws://localhost:18789`
- 检查浏览器控制台 WebSocket 错误

**问题 3: 样式错误**
- 清除浏览器缓存
- 尝试隐私/无痕模式
- 检查 CSS 文件是否加载

**问题 4: 主题不生效**
- 检查浏览器开发者工具，确认 `data-theme` 属性
- 检查 CSS 变量是否定义
- 刷新页面

---

## 📊 性能测试

### 使用 Lighthouse

1. 打开 Chrome DevTools (F12)
2. 切换到 Lighthouse 面板
3. 选择 "Progressive Web App"
4. 点击 "Analyze page load"
5. 记录分数

**目标分数**:
- Performance: > 90
- Accessibility: > 90
- Best Practices: > 90
- SEO: 不适用（本地应用）

### 使用 Performance 面板

1. 打开 Chrome DevTools (F12)
2. 切换到 Performance 面板
3. 点击录制
4. 执行操作（输入、发送消息等）
5. 停止录制
6. 查看 FPS、帧时间等指标

**目标**:
- FPS: 60
- 帧时间: < 16.6ms
- 长任务: 无

---

## ✅ 测试完成标准

### Phase 1 MVP 验收标准

**必需功能**:
- [x] 聊天页面 UI 正常
- [x] 设置页面 UI 正常
- [x] 主题切换正常
- [x] 响应式设计正常
- [x] WebSocket 连接正常
- [x] 消息收发正常

**质量标准**:
- [x] Lint 通过（0 错误）
- [x] 单元测试通过（25/25）
- [x] 构建成功
- [x] 控制台无错误
- [x] 性能良好

**可交付性**:
- [x] 可以独立部署
- [x] 可以用于演示
- [x] 可以开始用户测试

---

## 📝 测试记录模板

```markdown
## 测试记录

**测试人员**: [姓名]
**测试日期**: [日期]
**浏览器**: [类型和版本]
**设备**: [类型]
**操作系统**: [版本]

### 功能测试

| 功能 | 状态 | 备注 |
|------|------|------|
| 聊天页面 | ⬜ 未测 / ✅ 通过 / ❌ 失败 | |
| 设置页面 | ⬜ 未测 / ✅ 通过 / ❌ 失败 | |
| 主题切换 | ⬜ 未测 / ✅ 通过 / ❌ 失败 | |
| WebSocket | ⬜ 未测 / ✅ 通过 / ❌ 失败 | |
| 消息收发 | ⬜ 未测 / ✅ 通过 / ❌ 失败 | |

### 发现的问题

1. **问题标题**
   - 严重程度: 高/中/低
   - 描述: [详细描述]
   - 重现步骤: [步骤]
   - 预期行为: [应该怎样]
   - 实际行为: [实际怎样]

### 建议和反馈

- [ ] 建议内容

### 总体评价

- 用户体验: ⭐⭐⭐⭐⭐ (1-5)
- 稳定性: ⭐⭐⭐⭐⭐ (1-5)
- 性能: ⭐⭐⭐⭐⭐ (1-5)
```

---

## 🎯 下一步

测试完成后，根据反馈决定:

1. **Phase 1 优化**: 修复发现的问题
2. **Phase 2 开发**: 添加多媒体功能
3. **Phase 3 规划**: 语音助手功能

---

**文档版本**: v1.0
**创建日期**: 2025-02-04
**适用版本**: Phase 1 MVP
