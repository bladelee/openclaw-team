<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OpenClaw Multi-Instance Web Chat UI Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    header {
      background: rgba(255, 255, 255, 0.95);
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 24px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    h1 {
      color: #333;
      font-size: 28px;
      margin-bottom: 8px;
    }

    .subtitle {
      color: #666;
      font-size: 14px;
    }

    .controls {
      display: flex;
      gap: 12px;
      margin-top: 16px;
      flex-wrap: wrap;
    }

    .input-group {
      display: flex;
      gap: 8px;
      flex: 1;
      min-width: 300px;
    }

    input {
      flex: 1;
      padding: 10px 14px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    .btn-danger {
      background: #ef4444;
      color: white;
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .instances {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
      gap: 20px;
    }

    .instance-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .instance-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    }

    .instance-header {
      background: #f8f9fa;
      padding: 16px;
      border-bottom: 1px solid #e9ecef;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .instance-title {
      font-weight: 600;
      color: #333;
      font-size: 16px;
    }

    .instance-url {
      color: #666;
      font-size: 12px;
      margin-top: 4px;
      word-break: break-all;
    }

    .instance-actions {
      display: flex;
      gap: 8px;
    }

    .btn-icon {
      padding: 6px 12px;
      font-size: 12px;
    }

    .iframe-container {
      width: 100%;
      height: 500px;
      background: #f8f9fa;
      position: relative;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .iframe-placeholder {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #999;
      font-size: 14px;
      background: #f8f9fa;
    }

    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 6px;
    }

    .status-connected {
      background: #10b981;
    }

    .status-disconnected {
      background: #ef4444;
    }

    .status-loading {
      background: #f59e0b;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .empty-state {
      background: white;
      border-radius: 12px;
      padding: 60px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .empty-state-text {
      color: #666;
      font-size: 16px;
    }

    .quick-add {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    .btn-quick {
      padding: 6px 12px;
      font-size: 12px;
      background: #e0e7ff;
      color: #4338ca;
    }

    .btn-quick:hover {
      background: #c7d2fe;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>OpenClaw å¤šå®ä¾‹ Web Chat UI</h1>
      <p class="subtitle">é€šè¿‡ iframe åµŒå…¥å¤šä¸ª OpenClaw å®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹å¯é…ç½®ä¸åŒçš„ Gateway åœ°å€</p>

      <div class="input-group">
        <input type="text" id="instanceUrl" placeholder="è¾“å…¥ Gateway åœ°å€ (å¦‚: http://localhost:18789/__openclaw__/ui)" value="http://localhost:18789/__openclaw__/ui">
        <input type="text" id="instanceName" placeholder="å®ä¾‹åç§° (å¯é€‰)" value="OpenClaw æœ¬åœ°">
        <button class="btn-primary" onclick="addInstance()">æ·»åŠ å®ä¾‹</button>
      </div>

      <div class="quick-add">
        <button class="btn-quick" onclick="quickAdd('http://localhost:18789/__openclaw__/ui', 'æœ¬åœ° Gateway')">æœ¬åœ° Gateway</button>
        <button class="btn-quick" onclick="quickAdd('http://192.168.1.100:18789/__openclaw__/ui', 'è¿œç¨‹ Gateway')">è¿œç¨‹ Gateway</button>
        <button class="btn-quick" onclick="quickAdd('http://localhost:18789/__openclaw__/a2ui/react', 'A2UI React')">A2UI React</button>
      </div>

      <div class="controls" style="margin-top: 16px;">
        <button class="btn-secondary" onclick="loadFromStorage()">ä»æœ¬åœ°å­˜å‚¨åŠ è½½</button>
        <button class="btn-secondary" onclick="saveToStorage()">ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨</button>
        <button class="btn-danger" onclick="clearAllInstances()">æ¸…ç©ºæ‰€æœ‰</button>
      </div>
    </header>

    <div id="instances" class="instances">
      <div class="empty-state">
        <div class="empty-state-icon">ğŸ–¼ï¸</div>
        <div class="empty-state-text">è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•å®ä¾‹ï¼Œè¯·åœ¨ä¸Šæ–¹æ·»åŠ </div>
      </div>
    </div>
  </div>

  <script>
    // å­˜å‚¨æ‰€æœ‰å®ä¾‹
    let instances = [];
    let instanceCounter = 0;

    // ä»æœ¬åœ°å­˜å‚¨åŠ è½½
    function loadFromStorage() {
      const saved = localStorage.getItem('openclaw_instances');
      if (saved) {
        try {
          instances = JSON.parse(saved);
          renderInstances();
        } catch (e) {
          console.error('åŠ è½½å¤±è´¥:', e);
        }
      } else {
        alert('æ²¡æœ‰ä¿å­˜çš„å®ä¾‹');
      }
    }

    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
    function saveToStorage() {
      localStorage.setItem('openclaw_instances', JSON.stringify(instances));
      alert('å·²ä¿å­˜ ' + instances.length + ' ä¸ªå®ä¾‹');
    }

    // å¿«é€Ÿæ·»åŠ é¢„è®¾å®ä¾‹
    function quickAdd(url, name) {
      document.getElementById('instanceUrl').value = url;
      document.getElementById('instanceName').value = name;
      addInstance();
    }

    // æ·»åŠ å®ä¾‹
    function addInstance() {
      const url = document.getElementById('instanceUrl').value.trim();
      const name = document.getElementById('instanceName').value.trim() || `å®ä¾‹ ${instances.length + 1}`;

      if (!url) {
        alert('è¯·è¾“å…¥ Gateway åœ°å€');
        return;
      }

      // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
      if (instances.some(inst => inst.url === url)) {
        alert('è¯¥åœ°å€å·²å­˜åœ¨');
        return;
      }

      const instance = {
        id: ++instanceCounter,
        name,
        url,
        status: 'loading'
      };

      instances.push(instance);
      renderInstances();

      // æ¸…ç©ºè¾“å…¥æ¡†
      document.getElementById('instanceUrl').value = 'http://localhost:18789/__openclaw__/ui';
      document.getElementById('instanceName').value = 'OpenClaw æœ¬åœ°';
    }

    // åˆ é™¤å®ä¾‹
    function removeInstance(id) {
      instances = instances.filter(inst => inst.id !== id);
      renderInstances();
    }

    // åˆ·æ–°å®ä¾‹
    function refreshInstance(id) {
      const instance = instances.find(inst => inst.id === id);
      if (instance) {
        const iframe = document.getElementById(`iframe-${id}`);
        if (iframe) {
          iframe.src = iframe.src;
        }
      }
    }

    // æ›´æ–°è¿æ¥çŠ¶æ€
    function updateInstanceStatus(id, status) {
      const instance = instances.find(inst => inst.id === id);
      if (instance) {
        instance.status = status;
        const statusIndicator = document.getElementById(`status-${id}`);
        if (statusIndicator) {
          statusIndicator.className = 'status-indicator status-' + status;
        }
      }
    }

    // æ¸²æŸ“æ‰€æœ‰å®ä¾‹
    function renderInstances() {
      const container = document.getElementById('instances');

      if (instances.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ–¼ï¸</div>
            <div class="empty-state-text">è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•å®ä¾‹ï¼Œè¯·åœ¨ä¸Šæ–¹æ·»åŠ </div>
          </div>
        `;
        return;
      }

      container.innerHTML = instances.map(instance => `
        <div class="instance-card">
          <div class="instance-header">
            <div>
              <div class="instance-title">
                <span id="status-${instance.id}" class="status-indicator status-${instance.status}"></span>
                ${escapeHtml(instance.name)}
              </div>
              <div class="instance-url">${escapeHtml(instance.url)}</div>
            </div>
            <div class="instance-actions">
              <button class="btn-icon btn-secondary" onclick="refreshInstance(${instance.id})" title="åˆ·æ–°">ğŸ”„</button>
              <button class="btn-icon btn-danger" onclick="removeInstance(${instance.id})" title="åˆ é™¤">âœ•</button>
            </div>
          </div>
          <div class="iframe-container">
            <iframe
              id="iframe-${instance.id}"
              src="${escapeHtml(instance.url)}"
              onload="updateInstanceStatus(${instance.id}, 'connected')"
              onerror="updateInstanceStatus(${instance.id}, 'disconnected')"
              allow="clipboard-write; clipboard-read"
              sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals"
            ></iframe>
          </div>
        </div>
      `).join('');
    }

    // HTML è½¬ä¹‰
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // æ¸…ç©ºæ‰€æœ‰å®ä¾‹
    function clearAllInstances() {
      if (instances.length === 0) return;
      if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å®ä¾‹å—ï¼Ÿ')) {
        instances = [];
        renderInstances();
        localStorage.removeItem('openclaw_instances');
      }
    }

    // é¡µé¢åŠ è½½æ—¶å°è¯•æ¢å¤
    window.addEventListener('load', () => {
      const saved = localStorage.getItem('openclaw_instances');
      if (saved) {
        try {
          instances = JSON.parse(saved);
          instanceCounter = instances.reduce((max, inst) => Math.max(max, inst.id), 0);
          renderInstances();
        } catch (e) {
          console.error('åŠ è½½å¤±è´¥:', e);
        }
      }
    });

    // ç›‘å¬æ¥è‡ª iframe çš„æ¶ˆæ¯
    window.addEventListener('message', (event) => {
      // éªŒè¯æ¥æºï¼ˆå¯é€‰ï¼‰
      // if (event.origin !== 'http://localhost:18789') return;

      console.log('æ”¶åˆ° iframe æ¶ˆæ¯:', event.data);

      // å¯ä»¥æ ¹æ®æ¶ˆæ¯ç±»å‹å¤„ç†ä¸åŒçš„äº‹ä»¶
      if (event.data.type === 'chat') {
        console.log('Chat äº‹ä»¶:', event.data);
      } else if (event.data.type === 'status') {
        console.log('çŠ¶æ€æ›´æ–°:', event.data);
      }
    });
  </script>
</body>
</html>
